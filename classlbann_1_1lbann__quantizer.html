<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>LBANN: lbann::lbann_quantizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LBANN
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classlbann_1_1lbann__quantizer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classlbann_1_1lbann__quantizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">lbann::lbann_quantizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:af6bfe410c16ab39ca55861afb7c53134"><td class="memItemLeft" align="right" valign="top">typedef uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a></td></tr>
<tr class="separator:af6bfe410c16ab39ca55861afb7c53134"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad6499ee349e94a461538a8e4f867048"><td class="memItemLeft" align="right" valign="top">typedef int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a></td></tr>
<tr class="separator:aad6499ee349e94a461538a8e4f867048"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f0b1c91b994c91dfa506869e3329db6"><td class="memItemLeft" align="right" valign="top">typedef El::Matrix&lt; <a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a></td></tr>
<tr class="separator:a2f0b1c91b994c91dfa506869e3329db6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84c968d0f772235faa39f6ad91e7eadb"><td class="memItemLeft" align="right" valign="top">typedef std::vector&lt; <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a></td></tr>
<tr class="separator:a84c968d0f772235faa39f6ad91e7eadb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a430cd47f333c678d2cb77f4ab2693914"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a430cd47f333c678d2cb77f4ab2693914">lbann_quantizer</a> ()</td></tr>
<tr class="separator:a430cd47f333c678d2cb77f4ab2693914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0cc07008ff963949c2cb7b91786c61c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ac0cc07008ff963949c2cb7b91786c61c">~lbann_quantizer</a> ()</td></tr>
<tr class="separator:ac0cc07008ff963949c2cb7b91786c61c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a984561ba4f4fa54bd42d9ea407ec4319"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">quantize</a> (<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror)</td></tr>
<tr class="separator:a984561ba4f4fa54bd42d9ea407ec4319"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f7cc2e454aecf71d5326fef7aec5947"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a7f7cc2e454aecf71d5326fef7aec5947">quantize</a> (<a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror)</td></tr>
<tr class="separator:a7f7cc2e454aecf71d5326fef7aec5947"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c763978957572c718ddc4c0544833e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e">unquantize</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool apply=false)</td></tr>
<tr class="separator:a02c763978957572c718ddc4c0544833e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a7fe58287a9ff7a02ea91954d8b9d80"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a8a7fe58287a9ff7a02ea91954d8b9d80">unquantize</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;qmat, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, bool apply=false)</td></tr>
<tr class="separator:a8a7fe58287a9ff7a02ea91954d8b9d80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97db186341c0819c8d52e2f815deb2a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7">intermodel_sum_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool do_adagrad=false, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *gradhist=nullptr)</td></tr>
<tr class="separator:a97db186341c0819c8d52e2f815deb2a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4877befb2683f16a03fdf91ed1353636"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636">intermodel_sum_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool do_adagrad=false, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *gradhist=nullptr)</td></tr>
<tr class="separator:a4877befb2683f16a03fdf91ed1353636"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e271e3f75667540f5bde94fbcd3ef0e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e">intermodel_sum_quantized2</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror)</td></tr>
<tr class="separator:a0e271e3f75667540f5bde94fbcd3ef0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35ca3e61f358ccb63c233d85236dfec1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1">intermodel_sum_quantized2</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror)</td></tr>
<tr class="separator:a35ca3e61f358ccb63c233d85236dfec1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e6b9ef9d238dbd22aa6ac09ed9f4c07"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07">threshold_quantize</a> (<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg=0.0f, DataType neg_avg=0.0f)</td></tr>
<tr class="separator:a8e6b9ef9d238dbd22aa6ac09ed9f4c07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af354ffcac598f73d4918fba2bd2d5a7e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#af354ffcac598f73d4918fba2bd2d5a7e">threshold_quantize</a> (<a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg=0.0f, DataType neg_avg=0.0f)</td></tr>
<tr class="separator:af354ffcac598f73d4918fba2bd2d5a7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee4520768fa2d7d8869a9e4aea11b95b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">threshold_unquantize</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_avg, bool apply=false)</td></tr>
<tr class="separator:aee4520768fa2d7d8869a9e4aea11b95b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a259a27d1564f652217d590c52367f33f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a259a27d1564f652217d590c52367f33f">threshold_unquantize</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_avg, bool apply=false)</td></tr>
<tr class="separator:a259a27d1564f652217d590c52367f33f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab95bed99886e321b761b4f10eb5ce515"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515">adaptive_threshold_quantize</a> (<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:ab95bed99886e321b761b4f10eb5ce515"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24b33416be75079ede91a63fb72c4a06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a24b33416be75079ede91a63fb72c4a06">adaptive_threshold_quantize</a> (<a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion)</td></tr>
<tr class="separator:a24b33416be75079ede91a63fb72c4a06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec6e35d5a880e9d4eedf25002f15e4fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc">adaptive_threshold_unquantize</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool apply=false)</td></tr>
<tr class="separator:aec6e35d5a880e9d4eedf25002f15e4fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e5261b17fe2f3a8c52c12114e8b3873"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a7e5261b17fe2f3a8c52c12114e8b3873">adaptive_threshold_unquantize</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, bool apply=false)</td></tr>
<tr class="separator:a7e5261b17fe2f3a8c52c12114e8b3873"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cf9d4cd5262b21939e95fc34ad0a09f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f">intermodel_sum_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr class="separator:a4cf9d4cd5262b21939e95fc34ad0a09f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae99dc11003cecd04e599d68c99d90c0b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b">intermodel_sum_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr class="separator:ae99dc11003cecd04e599d68c99d90c0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28e74da8473ea1b475ff3976676898c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4">intermodel_sum_adaptive_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr class="separator:a28e74da8473ea1b475ff3976676898c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf0864e7c687806af3155655a33ed364"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364">intermodel_sum_adaptive_threshold_quantized</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;qerror, int proportion, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;im_qerror, bool compress=true)</td></tr>
<tr class="separator:acf0864e7c687806af3155655a33ed364"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7c7a99b0e059487a51c6679acbf9eb4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4">compress_thresholds</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq)</td></tr>
<tr class="separator:ae7c7a99b0e059487a51c6679acbf9eb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa257330ece9faa69f3dbef34e1ed80e2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#aa257330ece9faa69f3dbef34e1ed80e2">compress_adaptive_thresholds</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq)</td></tr>
<tr class="separator:aa257330ece9faa69f3dbef34e1ed80e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0630145bb4f0d9755ee55babf098e192"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192">uncompress_thresholds</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q)</td></tr>
<tr class="separator:a0630145bb4f0d9755ee55babf098e192"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a328e2bccf4ad0925e7f3efb6c9342b52"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a328e2bccf4ad0925e7f3efb6c9342b52">uncompress_adaptive_thresholds</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q)</td></tr>
<tr class="separator:a328e2bccf4ad0925e7f3efb6c9342b52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a271666e157eb4a4264520554ef275077"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a271666e157eb4a4264520554ef275077">proportion_threshold_average</a> (<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, int proportion)</td></tr>
<tr class="separator:a271666e157eb4a4264520554ef275077"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a52820f8b0868a7f8f3a57ade0c663c3c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">get_quantized_matrix_height</a> (const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat) const </td></tr>
<tr class="separator:a52820f8b0868a7f8f3a57ade0c663c3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a093ad67bd1dcc6c11f76ee69dcf913d8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a093ad67bd1dcc6c11f76ee69dcf913d8">threshold_unquantize</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, ThreshQuantized::iterator qstart, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_avg, bool apply=false)</td></tr>
<tr class="separator:a093ad67bd1dcc6c11f76ee69dcf913d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc4a0b39cb0634a3b75597fbaeb6e3c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#afc4a0b39cb0634a3b75597fbaeb6e3c0">compress_thresholds</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q, ThreshQuantized::iterator qstart, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq)</td></tr>
<tr class="separator:afc4a0b39cb0634a3b75597fbaeb6e3c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a861a35c39d55ebec8bd1c385378c2109"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a861a35c39d55ebec8bd1c385378c2109">uncompress_thresholds</a> (<a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;cq, ThreshQuantized::iterator cqstart, <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;q)</td></tr>
<tr class="separator:a861a35c39d55ebec8bd1c385378c2109"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adea3a61b63e75b577a7e28ff45f2b20a"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:adea3a61b63e75b577a7e28ff45f2b20a"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#adea3a61b63e75b577a7e28ff45f2b20a">intermodel_ring_reduce_scatter</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool var_recv, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, IR, IR, int &amp;)&gt; send_trans, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; recv_trans)</td></tr>
<tr class="separator:adea3a61b63e75b577a7e28ff45f2b20a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdfe2509be7c3761f4b98dfce03b18a6"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:acdfe2509be7c3761f4b98dfce03b18a6"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#acdfe2509be7c3761f4b98dfce03b18a6">intermodel_ring_allgather</a> (<a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *<a class="el" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;mat, bool var_recv, std::function&lt; void(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; reduced_trans, std::function&lt; T *(int &amp;)&gt; get_send_buf, std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt; get_recv_buf, std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt; recv_trans, std::function&lt; void(T *, T *)&gt; swap_bufs)</td></tr>
<tr class="separator:acdfe2509be7c3761f4b98dfce03b18a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a33ea17392f53b90e91aea1ffb7e11d68"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> = sizeof(<a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>) * 8</td></tr>
<tr class="separator:a33ea17392f53b90e91aea1ffb7e11d68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad98118c77f676fa3d3fb4ba27b814070"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> = 16</td></tr>
<tr class="separator:ad98118c77f676fa3d3fb4ba27b814070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f645c840854c584c9224af063fee23b"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> = 4</td></tr>
<tr class="separator:a5f645c840854c584c9224af063fee23b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Perform one-bit quantization of matrices (by column) with the quantization threshold at 0. Optionally do thresholding and entropy coding. Relevant references: "1-Bit Stochastic Gradient Descent and its Application to Data-Parallel
Distributed Training of Speech DNNs" by Frank Seide et al. (MSR) "Scalable Distributed DNN Training Using Commodity GPU Cloud Computing" by Nikko Strom. (Amazon) </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00050">50</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="aad6499ee349e94a461538a8e4f867048"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int32_t <a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">lbann::lbann_quantizer::qtype</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00055">55</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2f0b1c91b994c91dfa506869e3329db6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef El::Matrix&lt;<a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>&gt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">lbann::lbann_quantizer::QuantizedMatrix</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This represents a quantized version of a matrix. Each column is quantized separately. The first two entries are floats representing the positive and negative averages for the column (used in dequantizion). The rest is one-bit quantized entries. Quantization is by column to keep averages nice and because Elemental uses column-major ordering. This is int32_t because Elemental matrices don't support unsigned or &gt;32-bit types. It forces some type-casting annoyances. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00066">66</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a84c968d0f772235faa39f6ad91e7eadb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::vector&lt;<a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>&gt; <a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">lbann::lbann_quantizer::ThreshQuantized</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00067">67</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="af6bfe410c16ab39ca55861afb7c53134"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef uint32_t <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>We require that sizeof(DataType) == sizeof(qtype) == sizeof(uqtype). </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00054">54</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a430cd47f333c678d2cb77f4ab2693914"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::lbann_quantizer::lbann_quantizer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00035">35</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                                 {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac0cc07008ff963949c2cb7b91786c61c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">lbann::lbann_quantizer::~lbann_quantizer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00039">39</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                  {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ab95bed99886e321b761b4f10eb5ce515"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_quantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Threshold and quantize a matrix, dynamically choosing the threshold and quantization values. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">q</td><td>The output list of quantized entries. </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
    <tr><td class="paramname">proportion</td><td>Quantize one in proportion of the values. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00369">369</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                                                                               {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh, neg_thresh, pos_avg, neg_avg;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  std::tie(pos_thresh, neg_thresh, pos_avg, neg_avg) =</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#a271666e157eb4a4264520554ef275077">proportion_threshold_average</a>(mat, proportion);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="comment">// Store the averages for reconstruction.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> tmp;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  memcpy(&amp;tmp, &amp;pos_avg, <span class="keyword">sizeof</span>(pos_avg));</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  q.push_back(tmp);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  memcpy(&amp;tmp, &amp;neg_avg, <span class="keyword">sizeof</span>(neg_avg));</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  q.push_back(tmp);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  <span class="comment">// Do regular thresholded quantization with the computed values.</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07">threshold_quantize</a>(mat, q, qerror, pos_thresh, neg_thresh, pos_avg, neg_avg);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a271666e157eb4a4264520554ef275077"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a271666e157eb4a4264520554ef275077">lbann::lbann_quantizer::proportion_threshold_average</a></div><div class="ttdeci">std::tuple&lt; DataType, DataType, DataType, DataType &gt; proportion_threshold_average(Mat &amp;mat, int proportion)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00748">lbann_quantizer.cpp:748</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a8e6b9ef9d238dbd22aa6ac09ed9f4c07"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07">lbann::lbann_quantizer::threshold_quantize</a></div><div class="ttdeci">void threshold_quantize(Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, DataType pos_avg=0.0f, DataType neg_avg=0.0f)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00273">lbann_quantizer.cpp:273</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00035">lbann_base.hpp:35</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ab95bed99886e321b761b4f10eb5ce515_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ab95bed99886e321b761b4f10eb5ce515_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ab95bed99886e321b761b4f10eb5ce515_cgraph" id="classlbann_1_1lbann__quantizer_ab95bed99886e321b761b4f10eb5ce515_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a271666e157eb4a4264520554ef275077" title="lbann::lbann_quantizer\l::proportion_threshold\l_average" alt="" coords="253,5,409,57"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="253,81,409,120"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ab95bed99886e321b761b4f10eb5ce515_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ab95bed99886e321b761b4f10eb5ce515_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ab95bed99886e321b761b4f10eb5ce515_icgraph" id="classlbann_1_1lbann__quantizer_ab95bed99886e321b761b4f10eb5ce515_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a24b33416be75079ede91a63fb72c4a06" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="253,5,452,44"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="261,68,443,120"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="508,29,673,81"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="500,105,681,157"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a24b33416be75079ede91a63fb72c4a06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_quantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00384">384</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                                                               {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515">adaptive_threshold_quantize</a>(mat.Matrix(), q, qerror, proportion);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab95bed99886e321b761b4f10eb5ce515"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515">lbann::lbann_quantizer::adaptive_threshold_quantize</a></div><div class="ttdeci">void adaptive_threshold_quantize(Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, int proportion)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00369">lbann_quantizer.cpp:369</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a24b33416be75079ede91a63fb72c4a06_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a24b33416be75079ede91a63fb72c4a06_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a24b33416be75079ede91a63fb72c4a06_cgraph" id="classlbann_1_1lbann__quantizer_a24b33416be75079ede91a63fb72c4a06_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="253,47,452,85"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a271666e157eb4a4264520554ef275077" title="lbann::lbann_quantizer\l::proportion_threshold\l_average" alt="" coords="500,5,656,57"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="500,81,656,120"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aec6e35d5a880e9d4eedf25002f15e4fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>apply</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize an adaptively-thresholded-and-quantized matrix. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">q</td><td>The quantizd matrix. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
    <tr><td class="paramname">apply</td><td>Whether to add unquantized data to existing entries or replace existing entries. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00390">390</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                                            {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">// Get the averages out.</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg = *((<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>*) &amp;(q[0]));</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_avg = *((<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>*) &amp;(q[1]));</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">threshold_unquantize</a>(q, q.begin() + 2, mat, pos_avg, neg_avg, apply);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aee4520768fa2d7d8869a9e4aea11b95b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">lbann::lbann_quantizer::threshold_unquantize</a></div><div class="ttdeci">void threshold_unquantize(ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_avg, DataType neg_avg, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00325">lbann_quantizer.cpp:325</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00035">lbann_base.hpp:35</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aec6e35d5a880e9d4eedf25002f15e4fc_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aec6e35d5a880e9d4eedf25002f15e4fc_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aec6e35d5a880e9d4eedf25002f15e4fc_cgraph" id="classlbann_1_1lbann__quantizer_aec6e35d5a880e9d4eedf25002f15e4fc_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="267,5,424,44"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aec6e35d5a880e9d4eedf25002f15e4fc_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aec6e35d5a880e9d4eedf25002f15e4fc_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aec6e35d5a880e9d4eedf25002f15e4fc_icgraph" id="classlbann_1_1lbann__quantizer_aec6e35d5a880e9d4eedf25002f15e4fc_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a7e5261b17fe2f3a8c52c12114e8b3873" title="lbann::lbann_quantizer\l::adaptive_threshold_unquantize" alt="" coords="267,5,481,44"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="284,68,465,120"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="537,29,703,81"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="529,105,711,157"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7e5261b17fe2f3a8c52c12114e8b3873"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::adaptive_threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>apply</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00398">398</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                                                {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc">adaptive_threshold_unquantize</a>(q, mat.Matrix(), apply);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aec6e35d5a880e9d4eedf25002f15e4fc"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc">lbann::lbann_quantizer::adaptive_threshold_unquantize</a></div><div class="ttdeci">void adaptive_threshold_unquantize(ThreshQuantized &amp;q, Mat &amp;mat, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00390">lbann_quantizer.cpp:390</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a7e5261b17fe2f3a8c52c12114e8b3873_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a7e5261b17fe2f3a8c52c12114e8b3873_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a7e5261b17fe2f3a8c52c12114e8b3873_cgraph" id="classlbann_1_1lbann__quantizer_a7e5261b17fe2f3a8c52c12114e8b3873_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc" title="lbann::lbann_quantizer\l::adaptive_threshold_unquantize" alt="" coords="267,5,481,44"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="529,5,686,44"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa257330ece9faa69f3dbef34e1ed80e2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::compress_adaptive_thresholds </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00671">671</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                                                        {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  cq.push_back(q[0]);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  cq.push_back(q[1]);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4">compress_thresholds</a>(q, q.begin() + 2, cq);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ae7c7a99b0e059487a51c6679acbf9eb4"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4">lbann::lbann_quantizer::compress_thresholds</a></div><div class="ttdeci">void compress_thresholds(ThreshQuantized &amp;q, ThreshQuantized &amp;cq)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00582">lbann_quantizer.cpp:582</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa257330ece9faa69f3dbef34e1ed80e2_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa257330ece9faa69f3dbef34e1ed80e2_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa257330ece9faa69f3dbef34e1ed80e2_cgraph" id="classlbann_1_1lbann__quantizer_aa257330ece9faa69f3dbef34e1ed80e2_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4" title="lbann::lbann_quantizer\l::compress_thresholds" alt="" coords="267,5,423,44"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aa257330ece9faa69f3dbef34e1ed80e2_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aa257330ece9faa69f3dbef34e1ed80e2_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aa257330ece9faa69f3dbef34e1ed80e2_icgraph" id="classlbann_1_1lbann__quantizer_aa257330ece9faa69f3dbef34e1ed80e2_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="267,44,448,96"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="504,5,670,57"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="496,81,677,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae7c7a99b0e059487a51c6679acbf9eb4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::compress_thresholds </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compress the output of threshold_quantize. This uses Golumb-Rice coding, with the quotient stored first, followed by the remainder. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00582">582</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                                                               {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4">compress_thresholds</a>(q, q.begin(), cq);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ae7c7a99b0e059487a51c6679acbf9eb4"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4">lbann::lbann_quantizer::compress_thresholds</a></div><div class="ttdeci">void compress_thresholds(ThreshQuantized &amp;q, ThreshQuantized &amp;cq)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00582">lbann_quantizer.cpp:582</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae7c7a99b0e059487a51c6679acbf9eb4_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae7c7a99b0e059487a51c6679acbf9eb4_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ae7c7a99b0e059487a51c6679acbf9eb4_icgraph" id="classlbann_1_1lbann__quantizer_ae7c7a99b0e059487a51c6679acbf9eb4_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="223,37,409,89"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#aa257330ece9faa69f3dbef34e1ed80e2" title="lbann::lbann_quantizer\l::compress_adaptive_thresholds" alt="" coords="210,116,423,155"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="713,5,878,57"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="471,37,657,89"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="473,113,655,165"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="705,113,886,165"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afc4a0b39cb0634a3b75597fbaeb6e3c0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::compress_thresholds </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::iterator&#160;</td>
          <td class="paramname"><em>qstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handle compression starting from arbitrary locations. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00587">587</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                                                           {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="comment">// Handle empty input.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="keywordflow">if</span> (std::distance(qstart, q.end()) == 0) {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    cq.push_back(~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0));</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="comment">// Write to cur starting from cur&#39;s LSB.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> cur = 0;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  <span class="comment">// The current bit to write to. Thus there are NUM_BITS - cur_bit bits left.</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> cur_bit = 0;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> iter = qstart; iter != q.end(); ++iter) {</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> ent = *iter;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> quotient = ent &gt;&gt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> remainder = ent &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> - 1);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">// Write quotient in unary with a 0 as a terminator.</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">if</span> (cur_bit + quotient &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="comment">// Can fit the quotient in the current chunk.</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      cur |= ((1 &lt;&lt; quotient) - 1) &lt;&lt; cur_bit;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      cur_bit += quotient;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        cq.push_back(cur);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        cur = 0;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        cur_bit = 0;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="comment">// Need to split the quotient into multiple chunks.</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> bits_left = <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      <span class="comment">// Write the first bits_left 1s to the current chunk.</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      cur |= ((1 &lt;&lt; bits_left) - 1) &lt;&lt; cur_bit;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      cq.push_back(cur);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      cur = 0;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      cur_bit = 0;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      quotient -= bits_left;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="comment">// Now write chunks until we have less than NUM_BITS left to write.</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> i = 0; i &lt; quotient / <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++i) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        cq.push_back(~((<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) 0));</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="comment">// Lastly write the remaining 1s to a new chunk.</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      quotient %= <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="keywordflow">if</span> (quotient &gt; 0) {</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        cur = (1 &lt;&lt; quotient) - 1;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        cur_bit = quotient;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// Write the 0 terminator.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="comment">// There should always be at least one bit available here.</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    cur_bit += 1;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      cq.push_back(cur);</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      cur = 0;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      cur_bit = 0;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">// Write the remainder as a GR_K-bit binary string.</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">if</span> (cur_bit + GR_K &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="comment">// Can fit the remainder in the current chunk.</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      cur |= remainder &lt;&lt; cur_bit;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      cur_bit += <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        cq.push_back(cur);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        cur = 0;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        cur_bit = 0;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="comment">// Need to split the remainder into two chunks.</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> bits_left = <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="comment">// Write the first bits_left bits to the current chunk.</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      cur |= (remainder &amp; ((1 &lt;&lt; bits_left) - 1)) &lt;&lt; cur_bit;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      cq.push_back(cur);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <span class="comment">// Now write the remaining GR_K - bits_left bits to the new chunk.</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      cur = remainder &gt;&gt; bits_left;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      cur_bit = GR_K - bits_left;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    }</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  <span class="comment">// Pad the end of cur with 1s to terminate it (if needed).</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">if</span> (cur_bit &gt; 0) {</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> bits_left = <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    cur |= ((1 &lt;&lt; bits_left) - 1) &lt;&lt; cur_bit;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  }</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  <span class="keywordflow">if</span> (cur) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    cq.push_back(cur);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad98118c77f676fa3d3fb4ba27b814070"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">lbann::lbann_quantizer::GR_M</a></div><div class="ttdeci">static const uqtype GR_M</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00222">lbann_quantizer.hpp:222</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a5f645c840854c584c9224af063fee23b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">lbann::lbann_quantizer::GR_K</a></div><div class="ttdeci">static const uqtype GR_K</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00224">lbann_quantizer.hpp:224</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00217">lbann_quantizer.hpp:217</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a52820f8b0868a7f8f3a57ade0c663c3c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int lbann::lbann_quantizer::get_quantized_matrix_height </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Return the height of mat after quantization with <a class="el" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">quantize()</a>. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00227">227</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                                               {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">return</span> (mat.Height() + (<a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>-1)) / <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> + 2;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00217">lbann_quantizer.hpp:217</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a52820f8b0868a7f8f3a57ade0c663c3c_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a52820f8b0868a7f8f3a57ade0c663c3c_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a52820f8b0868a7f8f3a57ade0c663c3c_icgraph" id="classlbann_1_1lbann__quantizer_a52820f8b0868a7f8f3a57ade0c663c3c_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319" title="lbann::lbann_quantizer\l::quantize" alt="" coords="210,69,366,108"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="418,131,606,169"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a7f7cc2e454aecf71d5326fef7aec5947" title="lbann::lbann_quantizer\l::quantize" alt="" coords="434,68,590,107"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e" title="lbann::lbann_quantizer\l::intermodel_sum_quantized2" alt="" coords="414,5,610,44"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="673,96,839,148"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="662,172,851,211"/><area shape="rect" id="node8" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1" title="lbann::lbann_quantizer\l::intermodel_sum_quantized2" alt="" coords="658,5,854,44"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acdfe2509be7c3761f4b98dfce03b18a6"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_ring_allgather </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>var_recv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&#160;</td>
          <td class="paramname"><em>reduced_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>get_send_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>get_recv_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&#160;</td>
          <td class="paramname"><em>recv_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, T *)&gt;&#160;</td>
          <td class="paramname"><em>swap_bufs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00311">311</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                         {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordtype">int</span> rank = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordtype">int</span> nprocs = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models();</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <span class="comment">// Compute the number of columns each processor sends.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="comment">// The last processor handles the excess.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordtype">int</span> cols_per_proc = mat.Width() / nprocs;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  <span class="keywordtype">int</span> cols_remainder = mat.Width() % nprocs;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  <span class="keywordtype">int</span> local_col_width = cols_per_proc;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  <span class="keywordflow">if</span> (rank == nprocs - 1) local_col_width += cols_remainder;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="comment">// Get the portion of mat that was reduced.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  <span class="keyword">auto</span> reduced = mat(IR(0, mat.Height()),</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                     IR(rank * cols_per_proc,</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                        rank * cols_per_proc + local_col_width));</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">// Transform the reduced data.</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  reduced_trans(reduced);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="comment">// Compute the previous/next ranks in the ring.</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordtype">int</span> src = rank - 1;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">if</span> (src &lt; 0) src = nprocs - 1;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordtype">int</span> dst = (rank + 1) % nprocs;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">// Do the allgather.</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 0; step &lt; nprocs - 1; ++step) {</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">// Send our data or forward received data.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    lbann_mpi_req&lt;T&gt; req;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordtype">int</span> send_size;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    T* send_buf = get_send_buf(send_size);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;nb_send(send_buf, send_size, dst, req);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// Compute the original rank that sent the data we&#39;re going to receive.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordtype">int</span> data_src = (rank - step - 1) % nprocs;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span> (data_src &lt; 0) data_src += nprocs;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="comment">// Compute the amount of data we&#39;re receiving.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordtype">int</span> recv_col_width = cols_per_proc;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="keywordflow">if</span> (data_src == nprocs - 1) recv_col_width += cols_remainder;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// Get the portion of mat to receive into.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="keyword">auto</span> recv_view = mat(IR(0, mat.Height()),</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                         IR(data_src * cols_per_proc,</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                            data_src * cols_per_proc + recv_col_width));</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// Get receive buffer.</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordtype">int</span> recv_size = 0;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">if</span> (var_recv) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      recv_size = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_count&lt;T&gt;(src);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    T* recv_buf = get_recv_buf(recv_view, recv_size);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="comment">// Receive data.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;recv(recv_buf, recv_size, src);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// Transform the received portion.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    recv_trans(recv_buf, recv_view);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;wait&lt;T&gt;(req);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">// Swap so we forward the data we just received.</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    swap_bufs(send_buf, recv_buf);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    send_size = recv_size;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_acdfe2509be7c3761f4b98dfce03b18a6_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_acdfe2509be7c3761f4b98dfce03b18a6_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_acdfe2509be7c3761f4b98dfce03b18a6_cgraph" id="classlbann_1_1lbann__quantizer_acdfe2509be7c3761f4b98dfce03b18a6_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::\lget_model_rank" alt="" coords="245,5,390,44"/><area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::\lget_num_models" alt="" coords="245,68,390,107"/><area shape="rect" id="node4" href="classlbann_1_1lbann__comm.html#ae190682a58562e5d6e2648970b191153" title="lbann::lbann_comm::\lnb_send" alt="" coords="245,131,390,169"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#aa1db618eb587ead21fb0420bf94bfd45" title="lbann::lbann_comm::\lget_count" alt="" coords="245,193,390,232"/><area shape="rect" id="node6" href="classlbann_1_1lbann__comm.html#af8842cd4cea390f76d9146e1c4578de4" title="lbann::lbann_comm::recv" alt="" coords="233,256,403,281"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#a4c36955f250d936d1ae21a7408daefdd" title="lbann::lbann_comm::wait" alt="" coords="233,305,402,331"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="adea3a61b63e75b577a7e28ff45f2b20a"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_ring_reduce_scatter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>var_recv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, IR, IR, int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>send_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; T *(<a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;, int &amp;)&gt;&#160;</td>
          <td class="paramname"><em>get_recv_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::function&lt; void(T *, <a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;)&gt;&#160;</td>
          <td class="paramname"><em>recv_trans</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00262">262</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                          {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordtype">int</span> rank = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank();</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="keywordtype">int</span> nprocs = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="comment">// Compute the number of columns each processor sends.</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// The last processor handles the excess.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordtype">int</span> cols_per_proc = mat.Width() / nprocs;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="keywordtype">int</span> cols_remainder = mat.Width() % nprocs;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordtype">int</span> local_col_width = cols_per_proc;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordflow">if</span> (rank == nprocs - 1) local_col_width += cols_remainder;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  <span class="comment">// Local view into which to accumulate our received data.</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keyword">auto</span> accum_view = mat(IR(0, mat.Height()),</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                        IR(rank * cols_per_proc,</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                           rank * cols_per_proc + local_col_width));</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">// Do the reduce-scatter.</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> step = 1; step &lt; nprocs; ++step) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// Compute the source/destination.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordtype">int</span> dst = (rank + step) % nprocs;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordtype">int</span> src = (rank - step) % nprocs;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">if</span> (src &lt; 0) src += nprocs;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// Determine the number of columns to send.</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">int</span> send_col_width = cols_per_proc;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> (dst == nprocs - 1) send_col_width += cols_remainder;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="comment">// Transform the portion to send.</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordtype">int</span> send_size;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    T* send_buf = send_trans(</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      mat, IR(0, mat.Height()),</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      IR(dst * cols_per_proc, dst * cols_per_proc + send_col_width), send_size);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">// Send.</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    lbann_mpi_req&lt;T&gt; req;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;nb_send(send_buf, send_size, dst, req);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// Get receive buffer.</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordtype">int</span> recv_size = 0;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">if</span> (var_recv) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      recv_size = <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_count&lt;T&gt;(src);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    T* recv_buf = get_recv_buf(accum_view, recv_size);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// Receive.</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;recv(recv_buf, recv_size, src);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// Transform the received portion.</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    recv_trans(recv_buf, accum_view);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;wait&lt;T&gt;(req);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_adea3a61b63e75b577a7e28ff45f2b20a_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_adea3a61b63e75b577a7e28ff45f2b20a_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_adea3a61b63e75b577a7e28ff45f2b20a_cgraph" id="classlbann_1_1lbann__quantizer_adea3a61b63e75b577a7e28ff45f2b20a_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::\lget_model_rank" alt="" coords="235,5,380,44"/><area shape="rect" id="node3" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::\lget_num_models" alt="" coords="235,68,380,107"/><area shape="rect" id="node4" href="classlbann_1_1lbann__comm.html#ae190682a58562e5d6e2648970b191153" title="lbann::lbann_comm::\lnb_send" alt="" coords="235,131,380,169"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#aa1db618eb587ead21fb0420bf94bfd45" title="lbann::lbann_comm::\lget_count" alt="" coords="235,193,380,232"/><area shape="rect" id="node6" href="classlbann_1_1lbann__comm.html#af8842cd4cea390f76d9146e1c4578de4" title="lbann::lbann_comm::recv" alt="" coords="222,256,392,281"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#a4c36955f250d936d1ae21a7408daefdd" title="lbann::lbann_comm::wait" alt="" coords="223,305,392,331"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a28e74da8473ea1b475ff3976676898c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>compress</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As with intermodel_sum_quantized, but use adaptive threshold quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00492">492</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                 {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_quant;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_recv;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp_buf;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp_buf;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="keyword">auto</span> rs_send_trans = </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    [&amp;qerror, &amp;rs_quant, compress, proportion, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="keyword">auto</span> to_send = mat(h, w);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keyword">auto</span> to_send_qerr = qerror(h, w);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      rs_quant.clear();</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515">adaptive_threshold_quantize</a>(to_send, rs_quant, to_send_qerr, proportion);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#aa257330ece9faa69f3dbef34e1ed80e2">compress_adaptive_thresholds</a>(rs_quant, comp);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        std::swap(rs_quant, comp);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      count = rs_quant.size();</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      <span class="keywordflow">return</span> rs_quant.data();</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    };</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;  <span class="keyword">auto</span> rs_get_recv_buf = </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    [&amp;rs_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      rs_recv.resize(count);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <span class="keywordflow">return</span> rs_recv.data();</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    };</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keyword">auto</span> rs_recv_trans = </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    [&amp;rs_recv, compress, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>* buf, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a328e2bccf4ad0925e7f3efb6c9342b52">uncompress_adaptive_thresholds</a>(rs_recv, uncomp);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        std::swap(rs_recv, uncomp);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc">adaptive_threshold_unquantize</a>(rs_recv, accum, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    };</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  intermodel_ring_reduce_scatter&lt;uqtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">true</span>, rs_send_trans,</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                         rs_get_recv_buf, rs_recv_trans);</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_send;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_recv;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  <span class="keyword">auto</span> ag_reduced_trans =</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    [&amp;im_qerror, &amp;ag_send, compress, proportion, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">if</span> (im_qerror.Height() == 0) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        Zeros(im_qerror, reduced.Height(), reduced.Width());</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      }</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515">adaptive_threshold_quantize</a>(reduced, ag_send, im_qerror, proportion);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#aa257330ece9faa69f3dbef34e1ed80e2">compress_adaptive_thresholds</a>(ag_send, comp);</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        std::swap(comp, ag_send);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    };</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      count = ag_send.size();</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">return</span> ag_send.data();</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    };</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  <span class="keyword">auto</span> ag_get_recv_buf =</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    [&amp;ag_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      ag_recv.resize(count);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">return</span> ag_recv.data();</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    };</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keyword">auto</span> ag_recv_trans = </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    [&amp;ag_recv, compress, proportion, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a328e2bccf4ad0925e7f3efb6c9342b52">uncompress_adaptive_thresholds</a>(ag_recv, uncomp);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc">adaptive_threshold_unquantize</a>(uncomp, accum);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc">adaptive_threshold_unquantize</a>(ag_recv, accum);</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    };</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="keyword">auto</span> ag_swap_bufs =</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    [&amp;ag_send, &amp;ag_recv] (uqtype*, uqtype*) {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      std::swap(ag_send, ag_recv);</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    };</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  intermodel_ring_allgather&lt;uqtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">true</span>, ag_reduced_trans,</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                    ag_get_send_buf, ag_get_recv_buf,</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                                    ag_recv_trans, ag_swap_bufs);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a328e2bccf4ad0925e7f3efb6c9342b52"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a328e2bccf4ad0925e7f3efb6c9342b52">lbann::lbann_quantizer::uncompress_adaptive_thresholds</a></div><div class="ttdeci">void uncompress_adaptive_thresholds(ThreshQuantized &amp;cq, ThreshQuantized &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00740">lbann_quantizer.cpp:740</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ab95bed99886e321b761b4f10eb5ce515"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515">lbann::lbann_quantizer::adaptive_threshold_quantize</a></div><div class="ttdeci">void adaptive_threshold_quantize(Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, int proportion)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00369">lbann_quantizer.cpp:369</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a84c968d0f772235faa39f6ad91e7eadb"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">lbann::lbann_quantizer::ThreshQuantized</a></div><div class="ttdeci">std::vector&lt; uqtype &gt; ThreshQuantized</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00067">lbann_quantizer.hpp:67</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00040">lbann_base.hpp:40</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aec6e35d5a880e9d4eedf25002f15e4fc"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc">lbann::lbann_quantizer::adaptive_threshold_unquantize</a></div><div class="ttdeci">void adaptive_threshold_unquantize(ThreshQuantized &amp;q, Mat &amp;mat, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00390">lbann_quantizer.cpp:390</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aa257330ece9faa69f3dbef34e1ed80e2"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aa257330ece9faa69f3dbef34e1ed80e2">lbann::lbann_quantizer::compress_adaptive_thresholds</a></div><div class="ttdeci">void compress_adaptive_thresholds(ThreshQuantized &amp;q, ThreshQuantized &amp;cq)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00671">lbann_quantizer.cpp:671</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_cgraph" id="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="242,81,441,120"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#aa257330ece9faa69f3dbef34e1ed80e2" title="lbann::lbann_quantizer\l::compress_adaptive_thresholds" alt="" coords="235,144,448,183"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a328e2bccf4ad0925e7f3efb6c9342b52" title="lbann::lbann_quantizer\l::uncompress_adaptive\l_thresholds" alt="" coords="262,207,421,259"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc" title="lbann::lbann_quantizer\l::adaptive_threshold_unquantize" alt="" coords="235,283,449,321"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a271666e157eb4a4264520554ef275077" title="lbann::lbann_quantizer\l::proportion_threshold\l_average" alt="" coords="504,5,660,57"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="504,81,660,120"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4" title="lbann::lbann_quantizer\l::compress_thresholds" alt="" coords="504,144,660,183"/><area shape="rect" id="node8" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192" title="lbann::lbann_quantizer\l::uncompress_thresholds" alt="" coords="497,213,667,252"/><area shape="rect" id="node10" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="504,283,660,321"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_icgraph" id="classlbann_1_1lbann__quantizer_a28e74da8473ea1b475ff3976676898c4_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="243,5,408,57"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="235,81,416,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="acf0864e7c687806af3155655a33ed364"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>compress</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00575">575</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                 {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4">intermodel_sum_adaptive_threshold_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror,</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                                              proportion, im_qerror, compress);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a28e74da8473ea1b475ff3976676898c4"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4">lbann::lbann_quantizer::intermodel_sum_adaptive_threshold_quantized</a></div><div class="ttdeci">void intermodel_sum_adaptive_threshold_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, int proportion, Mat &amp;im_qerror, bool compress=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00492">lbann_quantizer.cpp:492</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_acf0864e7c687806af3155655a33ed364_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_acf0864e7c687806af3155655a33ed364_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_acf0864e7c687806af3155655a33ed364_cgraph" id="classlbann_1_1lbann__quantizer_acf0864e7c687806af3155655a33ed364_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="235,172,416,224"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="472,81,671,120"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#aa257330ece9faa69f3dbef34e1ed80e2" title="lbann::lbann_quantizer\l::compress_adaptive_thresholds" alt="" coords="465,144,678,183"/><area shape="rect" id="node8" href="classlbann_1_1lbann__quantizer.html#a328e2bccf4ad0925e7f3efb6c9342b52" title="lbann::lbann_quantizer\l::uncompress_adaptive\l_thresholds" alt="" coords="492,207,651,259"/><area shape="rect" id="node10" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc" title="lbann::lbann_quantizer\l::adaptive_threshold_unquantize" alt="" coords="464,283,678,321"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a271666e157eb4a4264520554ef275077" title="lbann::lbann_quantizer\l::proportion_threshold\l_average" alt="" coords="733,5,890,57"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="733,81,890,120"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4" title="lbann::lbann_quantizer\l::compress_thresholds" alt="" coords="733,144,890,183"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192" title="lbann::lbann_quantizer\l::uncompress_thresholds" alt="" coords="726,213,897,252"/><area shape="rect" id="node11" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="733,283,890,321"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a97db186341c0819c8d52e2f815deb2a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>do_adagrad</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *&#160;</td>
          <td class="paramname"><em>gradhist</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Do a sum reduction of mat over comm's inter-model communicator, with all communication being quantized. im_querror is a separate quantization error matrix that should be passed in each time this is called. This implements the allreduce using a ring-based reduce-scatter followed by a ring-based allgather. Matrices are sent quantized, are unquantized for the reduction, then the reduced matrix is requantized for the allgather. If do_adagrad is true, this scales the inter-mediate unquantized result as in AdaGrad, and uses gradhist to store the gradient history. If used, you should use <a class="el" href="classlbann_1_1SGD.html">SGD</a> as the optimizer for those layers to avoid applying AdaGrad twice. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00148">148</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                  {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  <span class="comment">// Local transpose so that we quantize each neuron instead of each feature.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> mat;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  Transpose(mat_, mat);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> qerror;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  Transpose(qerror_, qerror);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> to_send_quant;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> rs_recv;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keyword">auto</span> rs_send_trans =</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    [&amp;qerror, &amp;to_send_quant, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      <span class="keyword">auto</span> to_send = mat(h, w);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keyword">auto</span> to_send_qerr = qerror(h, w);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">quantize</a>(to_send, to_send_quant, to_send_qerr);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      count = to_send_quant.Height() * to_send_quant.Width();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="keywordflow">return</span> to_send_quant.Buffer();</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    };</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  <span class="keyword">auto</span> rs_get_recv_buf = </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    [&amp;rs_recv, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">if</span> (rs_recv.Width() != mat.Width()) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        rs_recv.Resize(<a class="code" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">get_quantized_matrix_height</a>(mat), mat.Width());</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;      count = rs_recv.Height() * rs_recv.Width();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordflow">return</span> rs_recv.Buffer();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    };</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keyword">auto</span> rs_recv_trans = </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    [&amp;rs_recv, <span class="keyword">this</span>] (<a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e">unquantize</a>(rs_recv, accum, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    };</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  intermodel_ring_reduce_scatter&lt;qtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, rs_send_trans,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                        rs_get_recv_buf, rs_recv_trans);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> ag_send;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> ag_recv;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  std::function&lt;DataType(DataType)&gt; <a class="code" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7">_sq</a> = [](<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> x) { <span class="keywordflow">return</span> x*x; };</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  std::function&lt;DataType(DataType)&gt; <a class="code" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839">_sqrt</a> =</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    [](<a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> x) { <span class="keywordflow">return</span> 1.0f / (std::sqrt(x) + 1e-8f); };</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">auto</span> ag_reduced_trans =</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    [&amp;im_qerror, &amp;ag_send, gradhist, do_adagrad, <a class="code" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7">_sq</a>, <a class="code" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839">_sqrt</a>, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordflow">if</span> (do_adagrad) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span> (gradhist-&gt;Height() == 0) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          Zeros(*gradhist, reduced.Height(), reduced.Width());</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> tmp(reduced);  <span class="comment">// Temporary for AdaGrad computations.</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment">// Compute squared gradient and store in history.</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        EntrywiseMap(tmp, _sq);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        *gradhist += tmp;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="comment">// Compute 1/sqrt(gradhist) with small perturbation.</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        Copy(*gradhist, tmp);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        EntrywiseMap(tmp, _sqrt);                     </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// Adjust update.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> reduced_copy(reduced);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        Hadamard(tmp, reduced_copy, reduced);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">if</span> (im_qerror.Height() == 0) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        Zeros(im_qerror, reduced.Height(), reduced.Width());</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">quantize</a>(reduced, ag_send, im_qerror);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    };</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      count = ag_send.Height() * ag_send.Width();</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">return</span> ag_send.Buffer();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    };</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <span class="keyword">auto</span> ag_get_recv_buf = </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    [&amp;ag_recv, <span class="keyword">this</span>] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      ag_recv.Resize(<a class="code" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">get_quantized_matrix_height</a>(recv_view), recv_view.Width());</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      count = ag_recv.Height() * ag_recv.Width();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">return</span> ag_recv.Buffer();</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    };</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  <span class="keyword">auto</span> ag_recv_trans = </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    [&amp;ag_recv, <span class="keyword">this</span>] (qtype*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e">unquantize</a>(ag_recv, accum);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    };</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keyword">auto</span> ag_swap_bufs = </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    [&amp;ag_send, &amp;ag_recv] (qtype*, qtype*) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      std::swap(ag_send, ag_recv);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    };</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  intermodel_ring_allgather&lt;qtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">false</span>, ag_reduced_trans,</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                   ag_get_send_buf, ag_get_recv_buf,</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                   ag_recv_trans, ag_swap_bufs);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  Transpose(mat, mat_);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  Transpose(qerror, qerror_);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a984561ba4f4fa54bd42d9ea407ec4319"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">lbann::lbann_quantizer::quantize</a></div><div class="ttdeci">void quantize(Mat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00043">lbann_quantizer.cpp:43</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a2f0b1c91b994c91dfa506869e3329db6"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">lbann::lbann_quantizer::QuantizedMatrix</a></div><div class="ttdeci">El::Matrix&lt; qtype &gt; QuantizedMatrix</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00066">lbann_quantizer.hpp:66</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a52820f8b0868a7f8f3a57ade0c663c3c"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">lbann::lbann_quantizer::get_quantized_matrix_height</a></div><div class="ttdeci">int get_quantized_matrix_height(const Mat &amp;mat) const </div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00227">lbann_quantizer.hpp:227</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aad6499ee349e94a461538a8e4f867048"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">int32_t qtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00055">lbann_quantizer.hpp:55</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a02c763978957572c718ddc4c0544833e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e">lbann::lbann_quantizer::unquantize</a></div><div class="ttdeci">void unquantize(QuantizedMatrix &amp;qmat, Mat &amp;mat, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00112">lbann_quantizer.cpp:112</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00040">lbann_base.hpp:40</a></div></div>
<div class="ttc" id="lbann__layer__fully__connected_8cpp_html_a199b2df97e18b083eb9ee655fec2dfc7"><div class="ttname"><a href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7">_sq</a></div><div class="ttdeci">DataType _sq(DataType x)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__layer__fully__connected_8cpp_source.html#l00190">lbann_layer_fully_connected.cpp:190</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00035">lbann_base.hpp:35</a></div></div>
<div class="ttc" id="lbann__layer__fully__connected_8cpp_html_afc141da3841a084e603a2e8db5b4a839"><div class="ttname"><a href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839">_sqrt</a></div><div class="ttdeci">DataType _sqrt(DataType x)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__layer__fully__connected_8cpp_source.html#l00191">lbann_layer_fully_connected.cpp:191</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph" id="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319" title="lbann::lbann_quantizer\l::quantize" alt="" coords="242,5,398,44"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="446,28,603,80"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="242,120,398,159"/><area shape="rect" id="node5" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7" title="_sq" alt="" coords="299,183,342,208"/><area shape="rect" id="node6" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839" title="_sqrt" alt="" coords="295,232,346,257"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph" id="classlbann_1_1lbann__quantizer_a97db186341c0819c8d52e2f815deb2a7_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="254,5,420,57"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="242,81,431,120"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4877befb2683f16a03fdf91ed1353636"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>do_adagrad</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> *&#160;</td>
          <td class="paramname"><em>gradhist</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00232">232</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                  {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7">intermodel_sum_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, im_qerror, do_adagrad,</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                           gradhist);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a97db186341c0819c8d52e2f815deb2a7"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7">lbann::lbann_quantizer::intermodel_sum_quantized</a></div><div class="ttdeci">void intermodel_sum_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, Mat &amp;im_qerror, bool do_adagrad=false, Mat *gradhist=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00148">lbann_quantizer.cpp:148</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph" id="classlbann_1_1lbann__quantizer_a4877befb2683f16a03fdf91ed1353636_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="242,120,431,159"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319" title="lbann::lbann_quantizer\l::quantize" alt="" coords="479,5,635,44"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="683,28,840,80"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="479,120,635,159"/><area shape="rect" id="node6" href="lbann__layer__fully__connected_8cpp.html#a199b2df97e18b083eb9ee655fec2dfc7" title="_sq" alt="" coords="536,183,579,208"/><area shape="rect" id="node7" href="lbann__layer__fully__connected_8cpp.html#afc141da3841a084e603a2e8db5b4a839" title="_sqrt" alt="" coords="532,232,583,257"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0e271e3f75667540f5bde94fbcd3ef0e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00239">239</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                                                                              {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> mat;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  Transpose(mat_, mat);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> qerror;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  Transpose(qerror_, qerror);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> qmat;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">quantize</a>(mat, qmat, qerror);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> recv_qmat;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  recv_qmat.Resize(qmat.Height(), qmat.Width());</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models(); ++i) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span> (i == <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank()) {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> dst = 0; dst &lt; <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_num_models(); ++dst) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> (dst != <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;get_model_rank()) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;          <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;send(qmat.Buffer(), qmat.Width() * qmat.Height(), dst);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>-&gt;recv(recv_qmat.Buffer(), recv_qmat.Width() * recv_qmat.Height(), i);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> uqmat;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      uqmat.Resize(mat.Height(), mat.Width());</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e">unquantize</a>(recv_qmat, uqmat);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      mat += uqmat;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  Transpose(mat, mat_);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  Transpose(qerror, qerror_);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a984561ba4f4fa54bd42d9ea407ec4319"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">lbann::lbann_quantizer::quantize</a></div><div class="ttdeci">void quantize(Mat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00043">lbann_quantizer.cpp:43</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a2f0b1c91b994c91dfa506869e3329db6"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">lbann::lbann_quantizer::QuantizedMatrix</a></div><div class="ttdeci">El::Matrix&lt; qtype &gt; QuantizedMatrix</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00066">lbann_quantizer.hpp:66</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a02c763978957572c718ddc4c0544833e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e">lbann::lbann_quantizer::unquantize</a></div><div class="ttdeci">void unquantize(QuantizedMatrix &amp;qmat, Mat &amp;mat, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00112">lbann_quantizer.cpp:112</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00040">lbann_base.hpp:40</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_cgraph" id="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319" title="lbann::lbann_quantizer\l::quantize" alt="" coords="258,12,415,51"/><area shape="rect" id="node4" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::\lget_num_models" alt="" coords="264,75,409,113"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::\lget_model_rank" alt="" coords="264,137,409,176"/><area shape="rect" id="node6" href="classlbann_1_1lbann__comm.html#a086078b881e7250df140ac116adb1939" title="lbann::lbann_comm::send" alt="" coords="250,200,424,225"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#af8842cd4cea390f76d9146e1c4578de4" title="lbann::lbann_comm::recv" alt="" coords="251,249,422,275"/><area shape="rect" id="node8" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="258,299,415,337"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="472,5,628,57"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_icgraph" id="classlbann_1_1lbann__quantizer_a0e271e3f75667540f5bde94fbcd3ef0e_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1" title="lbann::lbann_quantizer\l::intermodel_sum_quantized2" alt="" coords="250,5,446,44"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a35ca3e61f358ccb63c233d85236dfec1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_quantized2 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00268">268</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                                                                             {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e">intermodel_sum_quantized2</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, im_qerror);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;}</div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0e271e3f75667540f5bde94fbcd3ef0e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e">lbann::lbann_quantizer::intermodel_sum_quantized2</a></div><div class="ttdeci">void intermodel_sum_quantized2(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, Mat &amp;im_qerror)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00239">lbann_quantizer.cpp:239</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a35ca3e61f358ccb63c233d85236dfec1_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a35ca3e61f358ccb63c233d85236dfec1_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a35ca3e61f358ccb63c233d85236dfec1_cgraph" id="classlbann_1_1lbann__quantizer_a35ca3e61f358ccb63c233d85236dfec1_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e" title="lbann::lbann_quantizer\l::intermodel_sum_quantized2" alt="" coords="250,165,446,204"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319" title="lbann::lbann_quantizer\l::quantize" alt="" coords="503,12,659,51"/><area shape="rect" id="node5" href="classlbann_1_1lbann__comm.html#a54842b679a3756cf79b43baf46caf637" title="lbann::lbann_comm::\lget_num_models" alt="" coords="508,75,653,113"/><area shape="rect" id="node6" href="classlbann_1_1lbann__comm.html#a6c201108eb6b5a1e23021db29cef655b" title="lbann::lbann_comm::\lget_model_rank" alt="" coords="508,137,653,176"/><area shape="rect" id="node7" href="classlbann_1_1lbann__comm.html#a086078b881e7250df140ac116adb1939" title="lbann::lbann_comm::send" alt="" coords="494,200,668,225"/><area shape="rect" id="node8" href="classlbann_1_1lbann__comm.html#af8842cd4cea390f76d9146e1c4578de4" title="lbann::lbann_comm::recv" alt="" coords="496,249,666,275"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="503,299,659,337"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="716,5,872,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4cf9d4cd5262b21939e95fc34ad0a09f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>compress</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>As with intermodel_sum_quantized, but use threshold quantization. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00403">403</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                                                      {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_quant;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> rs_recv;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keyword">auto</span> rs_send_trans = </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    [&amp;qerror, &amp;rs_quant, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, IR h, IR w, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keyword">auto</span> to_send = mat(h, w);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keyword">auto</span> to_send_qerr = qerror(h, w);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      rs_quant.clear();</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07">threshold_quantize</a>(to_send, rs_quant, to_send_qerr, pos_thresh,</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                         neg_thresh);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4">compress_thresholds</a>(rs_quant, comp);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        std::swap(rs_quant, comp);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      count = rs_quant.size();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordflow">return</span> rs_quant.data();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    };</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="keyword">auto</span> rs_get_recv_buf = </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    [&amp;rs_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; mat, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      rs_recv.resize(count);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keywordflow">return</span> rs_recv.data();</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    };</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="keyword">auto</span> rs_recv_trans = </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    [&amp;rs_recv, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>* buf, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192">uncompress_thresholds</a>(rs_recv, uncomp);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        std::swap(rs_recv, uncomp);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">threshold_unquantize</a>(rs_recv, accum, pos_thresh, neg_thresh, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    };</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  intermodel_ring_reduce_scatter&lt;uqtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">true</span>, rs_send_trans,</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                                         rs_get_recv_buf, rs_recv_trans);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_send;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> ag_recv;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keyword">auto</span> ag_reduced_trans =</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    [&amp;im_qerror, &amp;ag_send, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; reduced) {</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <span class="keywordflow">if</span> (im_qerror.Height() == 0) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        Zeros(im_qerror, reduced.Height(), reduced.Width());</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07">threshold_quantize</a>(reduced, ag_send, im_qerror, pos_thresh, neg_thresh);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> comp;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4">compress_thresholds</a>(ag_send, comp);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        std::swap(ag_send, comp);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    };</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keyword">auto</span> ag_get_send_buf = [&amp;ag_send] (<span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      count = ag_send.size();</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordflow">return</span> ag_send.data();</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    };</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keyword">auto</span> ag_get_recv_buf =</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    [&amp;ag_recv] (<a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; recv_view, <span class="keywordtype">int</span>&amp; count) {</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      ag_recv.resize(count);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keywordflow">return</span> ag_recv.data();</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    };</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="keyword">auto</span> ag_recv_trans = </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    [&amp;ag_recv, compress, pos_thresh, neg_thresh, <span class="keyword">this</span>]</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>*, <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; accum) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">if</span> (compress) {</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> uncomp;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192">uncompress_thresholds</a>(ag_recv, uncomp);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">threshold_unquantize</a>(uncomp, accum, pos_thresh, neg_thresh);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">threshold_unquantize</a>(ag_recv, accum, pos_thresh, neg_thresh);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    };</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keyword">auto</span> ag_swap_bufs =</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    [&amp;ag_send, &amp;ag_recv] (uqtype*, uqtype*) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      std::swap(ag_send, ag_recv);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    };</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  intermodel_ring_allgather&lt;uqtype&gt;(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat, <span class="keyword">true</span>, ag_reduced_trans,</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                    ag_get_send_buf, ag_get_recv_buf,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                    ag_recv_trans, ag_swap_bufs);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aee4520768fa2d7d8869a9e4aea11b95b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">lbann::lbann_quantizer::threshold_unquantize</a></div><div class="ttdeci">void threshold_unquantize(ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_avg, DataType neg_avg, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00325">lbann_quantizer.cpp:325</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ae7c7a99b0e059487a51c6679acbf9eb4"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4">lbann::lbann_quantizer::compress_thresholds</a></div><div class="ttdeci">void compress_thresholds(ThreshQuantized &amp;q, ThreshQuantized &amp;cq)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00582">lbann_quantizer.cpp:582</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a84c968d0f772235faa39f6ad91e7eadb"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">lbann::lbann_quantizer::ThreshQuantized</a></div><div class="ttdeci">std::vector&lt; uqtype &gt; ThreshQuantized</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00067">lbann_quantizer.hpp:67</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a8e6b9ef9d238dbd22aa6ac09ed9f4c07"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07">lbann::lbann_quantizer::threshold_quantize</a></div><div class="ttdeci">void threshold_quantize(Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, DataType pos_avg=0.0f, DataType neg_avg=0.0f)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00273">lbann_quantizer.cpp:273</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00040">lbann_base.hpp:40</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0630145bb4f0d9755ee55babf098e192"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192">lbann::lbann_quantizer::uncompress_thresholds</a></div><div class="ttdeci">void uncompress_thresholds(ThreshQuantized &amp;cq, ThreshQuantized &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00678">lbann_quantizer.cpp:678</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph" id="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="246,5,402,44"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4" title="lbann::lbann_quantizer\l::compress_thresholds" alt="" coords="246,68,402,107"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192" title="lbann::lbann_quantizer\l::uncompress_thresholds" alt="" coords="239,131,409,169"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="246,193,402,232"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph" id="classlbann_1_1lbann__quantizer_a4cf9d4cd5262b21939e95fc34ad0a09f_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="249,5,415,57"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="239,81,425,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae99dc11003cecd04e599d68c99d90c0b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::intermodel_sum_threshold_quantized </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__comm.html">lbann_comm</a> *&#160;</td>
          <td class="paramname"><em>comm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>im_qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>compress</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00485">485</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                                      {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f">intermodel_sum_threshold_quantized</a>(<a class="code" href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a>, mat.Matrix(), qerror, pos_thresh,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                     neg_thresh, im_qerror, compress);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a4cf9d4cd5262b21939e95fc34ad0a09f"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f">lbann::lbann_quantizer::intermodel_sum_threshold_quantized</a></div><div class="ttdeci">void intermodel_sum_threshold_quantized(lbann_comm *comm, Mat &amp;mat, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, Mat &amp;im_qerror, bool compress=true)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00403">lbann_quantizer.cpp:403</a></div></div>
<div class="ttc" id="lbann__file__io_8cpp_html_ab048c6f9fcbcfaa57ce68b00263dbebe"><div class="ttname"><a href="lbann__file__io_8cpp.html#ab048c6f9fcbcfaa57ce68b00263dbebe">comm</a></div><div class="ttdeci">static MPI_Comm comm</div><div class="ttdef"><b>Definition:</b> <a href="lbann__file__io_8cpp_source.html#l00043">lbann_file_io.cpp:43</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph" id="classlbann_1_1lbann__quantizer_ae99dc11003cecd04e599d68c99d90c0b_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="239,93,425,145"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="480,5,636,44"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ae7c7a99b0e059487a51c6679acbf9eb4" title="lbann::lbann_quantizer\l::compress_thresholds" alt="" coords="480,68,636,107"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192" title="lbann::lbann_quantizer\l::uncompress_thresholds" alt="" coords="473,131,643,169"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="480,193,636,232"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a271666e157eb4a4264520554ef275077"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>, <a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> &gt; lbann::lbann_quantizer::proportion_threshold_average </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>proportion</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Compute positive and negative threshold values such that only one in proportion of positive and negative entries are greater than or equal to the threshold. Additionally, compute the average value of the positive and negative values greater than this threshold. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to compute threshold values for. </td></tr>
    <tr><td class="paramname">proportion</td><td>Proportion of entries to keep. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>In this order: The positive and negative threshold values, then the positive and negative averages. </dd></dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00748">748</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                                                                      {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="comment">// It would be nice if there were a better way to do this...</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  std::vector&lt;DataType&gt; pos_entries;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  std::vector&lt;DataType&gt; neg_entries;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; mat.Height(); ++row) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; mat.Width(); ++col) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat.Get(row, col);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        pos_entries.push_back(val);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="comment">// Flip negative entries to make selection easier.</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        neg_entries.push_back(-1 * val);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      }</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="comment">// Determine how many positive/negative entries we need to keep.</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  <span class="keywordtype">int</span> pos_to_keep = pos_entries.size() / proportion;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="keywordtype">int</span> neg_to_keep = neg_entries.size() / proportion;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="comment">// Determine the threshold value with a selection algorithm to keep only the</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="comment">// largest pos/neg_to_keep elements.</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="comment">// Set to 0 if there&#39;s none.</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="comment">// The partitioning also guarantees everything after the i&#39;th element is</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="comment">// greater than or equal to it.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_thresh = 0.0f;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_thresh = 0.0f;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_avg = 0.0f;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_avg = 0.0f;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordflow">if</span> (pos_to_keep &gt; 0 &amp;&amp; pos_entries.size() &gt; 0) {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keyword">auto</span> i = pos_entries.begin() + (pos_entries.size() - pos_to_keep);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    std::nth_element(pos_entries.begin(), i, pos_entries.end());</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    pos_thresh = *i;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordflow">for</span> (; i != pos_entries.end(); ++i) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      pos_avg += *i;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    }</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    pos_avg /= pos_to_keep;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordflow">if</span> (neg_to_keep &gt; 0 &amp;&amp; neg_entries.size() &gt; 0) {</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keyword">auto</span> i = neg_entries.begin() + (neg_entries.size() - neg_to_keep);</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    std::nth_element(neg_entries.begin(), i, neg_entries.end());</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    neg_thresh = -1 * (*i);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">for</span> (; i != neg_entries.end(); ++i) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      neg_avg -= *i;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    neg_avg /= neg_to_keep;</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordflow">return</span> std::make_tuple(pos_thresh, neg_thresh, pos_avg, neg_avg);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;}</div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00035">lbann_base.hpp:35</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a271666e157eb4a4264520554ef275077_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a271666e157eb4a4264520554ef275077_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a271666e157eb4a4264520554ef275077_icgraph" id="classlbann_1_1lbann__quantizer_a271666e157eb4a4264520554ef275077_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="210,40,409,79"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a24b33416be75079ede91a63fb72c4a06" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="457,5,656,44"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="466,68,647,120"/><area shape="rect" id="node5" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="712,29,878,81"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="704,105,886,157"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a984561ba4f4fa54bd42d9ea407ec4319"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::quantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Quantize a matrix. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">qmat</td><td>The output quantized matrix (will be resized). </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00043">43</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                                                                           {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">// Set up the quantized matrix. (+2 for the averages.)</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">size_t</span> qheight = <a class="code" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">get_quantized_matrix_height</a>(mat);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">size_t</span> qwidth = mat.Width();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  qmat.Resize(qheight, qwidth);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; mat.Width(); ++col) {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// First compute the positive and negative column averages.</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> pos_sum = 0.0f;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> neg_sum = 0.0f;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keywordtype">size_t</span> num_pos = 0;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordtype">size_t</span> num_neg = 0;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; mat.Height(); ++row) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat.Get(row, col) + qerror.Get(row, col);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        pos_sum += val;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        ++num_pos;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        neg_sum += val;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        ++num_neg;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_pos = 0.0f;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">if</span> (num_pos &gt; 0) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      avg_pos = pos_sum / num_pos;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_neg = 0.0f;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">if</span> (num_neg &gt; 0) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      avg_neg = neg_sum / num_neg;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// Store the averages.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// Use memcpy so that we don&#39;t violate aliasing rules.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a> tmp;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    memcpy(&amp;tmp, &amp;avg_pos, <span class="keyword">sizeof</span>(avg_pos));</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    qmat.Set(0, col, tmp);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    memcpy(&amp;tmp, &amp;avg_neg, <span class="keyword">sizeof</span>(avg_neg));</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    qmat.Set(1, col, tmp);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// Now quantize the column, NUM_BITS entries at a time.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">int</span> row_chunk = 0;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">int</span> qrow = 2;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">for</span> (; row_chunk &lt; mat.Height(); row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = 0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordtype">int</span> row = row_chunk + bit;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span> (row &gt;= mat.Height()) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat.Get(row, col) + qerror.Get(row, col);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> (val &gt;= 0.0f) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;          q |= 1 &lt;&lt; bit;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;          qerror.Set(row, col, val - avg_pos);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;          qerror.Set(row, col, val - avg_neg);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      qmat.Set(qrow, col, (<a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>) q);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      ++qrow;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a52820f8b0868a7f8f3a57ade0c663c3c"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c">lbann::lbann_quantizer::get_quantized_matrix_height</a></div><div class="ttdeci">int get_quantized_matrix_height(const Mat &amp;mat) const </div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00227">lbann_quantizer.hpp:227</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aad6499ee349e94a461538a8e4f867048"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">int32_t qtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00055">lbann_quantizer.hpp:55</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00217">lbann_quantizer.hpp:217</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00035">lbann_base.hpp:35</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a984561ba4f4fa54bd42d9ea407ec4319_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a984561ba4f4fa54bd42d9ea407ec4319_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a984561ba4f4fa54bd42d9ea407ec4319_cgraph" id="classlbann_1_1lbann__quantizer_a984561ba4f4fa54bd42d9ea407ec4319_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="210,5,366,57"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a984561ba4f4fa54bd42d9ea407ec4319_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a984561ba4f4fa54bd42d9ea407ec4319_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a984561ba4f4fa54bd42d9ea407ec4319_icgraph" id="classlbann_1_1lbann__quantizer_a984561ba4f4fa54bd42d9ea407ec4319_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a7f7cc2e454aecf71d5326fef7aec5947" title="lbann::lbann_quantizer\l::quantize" alt="" coords="230,19,386,57"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="213,81,402,120"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e" title="lbann::lbann_quantizer\l::intermodel_sum_quantized2" alt="" coords="210,144,406,183"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="469,5,635,57"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="458,81,646,120"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1" title="lbann::lbann_quantizer\l::intermodel_sum_quantized2" alt="" coords="454,144,650,183"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7f7cc2e454aecf71d5326fef7aec5947"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::quantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00106">106</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                                            {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; local_mat = mat.Matrix();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">quantize</a>(local_mat, qmat, qerror);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a984561ba4f4fa54bd42d9ea407ec4319"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319">lbann::lbann_quantizer::quantize</a></div><div class="ttdeci">void quantize(Mat &amp;mat, QuantizedMatrix &amp;qmat, Mat &amp;qerror)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00043">lbann_quantizer.cpp:43</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00040">lbann_base.hpp:40</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a7f7cc2e454aecf71d5326fef7aec5947_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a7f7cc2e454aecf71d5326fef7aec5947_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a7f7cc2e454aecf71d5326fef7aec5947_cgraph" id="classlbann_1_1lbann__quantizer_a7f7cc2e454aecf71d5326fef7aec5947_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a984561ba4f4fa54bd42d9ea407ec4319" title="lbann::lbann_quantizer\l::quantize" alt="" coords="210,12,366,51"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a52820f8b0868a7f8f3a57ade0c663c3c" title="lbann::lbann_quantizer\l::get_quantized_matrix\l_height" alt="" coords="414,5,570,57"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8e6b9ef9d238dbd22aa6ac09ed9f4c07"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_avg</em> = <code>0.0f</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_avg</em> = <code>0.0f</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Threshold and quantize a matrix. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mat</td><td>The matrix to quantize. </td></tr>
    <tr><td class="paramname">q</td><td>The output list of quantized entries. </td></tr>
    <tr><td class="paramname">qerror</td><td>Running quantization error. </td></tr>
    <tr><td class="paramname">pos_thresh</td><td>The positive threshold level. </td></tr>
    <tr><td class="paramname">neg_thresh</td><td>The negative threshold level. </td></tr>
    <tr><td class="paramname">pos_avg</td><td>The positive quantization value (0 for default). </td></tr>
    <tr><td class="paramname">neg_avg</td><td>The negative quantization value (0 for default). </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00273">273</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                                           {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <span class="keywordflow">if</span> (pos_avg == 0.0f) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    pos_avg = pos_thresh;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">if</span> (neg_avg == 0.0f) {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    neg_avg = neg_thresh;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="keyword">const</span> Int ldim = mat.LDim();</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="keywordtype">size_t</span> prev_pos = ~0ull;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; mat.Width(); ++col) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; mat.Height(); ++row) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> val = mat.Get(row, col) + qerror.Get(row, col);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordtype">size_t</span> pos = row + col * ldim;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">if</span> (val &gt;= pos_thresh) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">if</span> (prev_pos == ~0ull) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          prev_pos = pos;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;          pos -= prev_pos;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;          prev_pos += pos;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = pos &lt;&lt; 1;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        q |= 1;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        qerror.Set(row, col, val - pos_avg);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        quant.push_back(q);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val &lt;= neg_thresh) {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="keywordflow">if</span> (prev_pos == ~0ull) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          prev_pos = pos;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          pos -= prev_pos;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;          prev_pos += pos;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = pos &lt;&lt; 1;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        qerror.Set(row, col, val - neg_avg);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        quant.push_back(q);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        qerror.Set(row, col, val);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00035">lbann_base.hpp:35</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a8e6b9ef9d238dbd22aa6ac09ed9f4c07_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a8e6b9ef9d238dbd22aa6ac09ed9f4c07_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a8e6b9ef9d238dbd22aa6ac09ed9f4c07_icgraph" id="classlbann_1_1lbann__quantizer_a8e6b9ef9d238dbd22aa6ac09ed9f4c07_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#af354ffcac598f73d4918fba2bd2d5a7e" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="231,9,387,48"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#ab95bed99886e321b761b4f10eb5ce515" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="210,72,409,111"/><area shape="rect" id="node8" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="216,135,402,187"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a24b33416be75079ede91a63fb72c4a06" title="lbann::lbann_quantizer\l::adaptive_threshold_quantize" alt="" coords="457,5,656,44"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="466,68,647,120"/><area shape="rect" id="node6" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="712,133,878,185"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="704,57,886,109"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="464,197,649,249"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af354ffcac598f73d4918fba2bd2d5a7e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_quantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>qerror</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_avg</em> = <code>0.0f</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_avg</em> = <code>0.0f</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00317">317</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                                           {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07">threshold_quantize</a>(mat.Matrix(), q, qerror, pos_thresh, neg_thresh,</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                     pos_avg, neg_avg);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a8e6b9ef9d238dbd22aa6ac09ed9f4c07"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07">lbann::lbann_quantizer::threshold_quantize</a></div><div class="ttdeci">void threshold_quantize(Mat &amp;mat, ThreshQuantized &amp;q, Mat &amp;qerror, DataType pos_thresh, DataType neg_thresh, DataType pos_avg=0.0f, DataType neg_avg=0.0f)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00273">lbann_quantizer.cpp:273</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_af354ffcac598f73d4918fba2bd2d5a7e_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_af354ffcac598f73d4918fba2bd2d5a7e_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_af354ffcac598f73d4918fba2bd2d5a7e_cgraph" id="classlbann_1_1lbann__quantizer_af354ffcac598f73d4918fba2bd2d5a7e_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a8e6b9ef9d238dbd22aa6ac09ed9f4c07" title="lbann::lbann_quantizer\l::threshold_quantize" alt="" coords="210,5,366,44"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aee4520768fa2d7d8869a9e4aea11b95b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>apply</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize a thresholded-and-quantized matrix. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">q</td><td>The quantized matrix. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
    <tr><td class="paramname">pos_avg</td><td>The positive quantization value. </td></tr>
    <tr><td class="paramname">neg_avg</td><td>The negative quantization value. </td></tr>
    <tr><td class="paramname">apply</td><td>Whether to add unquantized data to existing entries or replace existing entries. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00325">325</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                                       {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">threshold_unquantize</a>(quant, quant.begin(), mat, pos_avg, neg_avg, apply);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aee4520768fa2d7d8869a9e4aea11b95b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">lbann::lbann_quantizer::threshold_unquantize</a></div><div class="ttdeci">void threshold_unquantize(ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_avg, DataType neg_avg, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00325">lbann_quantizer.cpp:325</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_aee4520768fa2d7d8869a9e4aea11b95b_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_aee4520768fa2d7d8869a9e4aea11b95b_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_aee4520768fa2d7d8869a9e4aea11b95b_icgraph" id="classlbann_1_1lbann__quantizer_aee4520768fa2d7d8869a9e4aea11b95b_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a259a27d1564f652217d590c52367f33f" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="238,9,395,48"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#aec6e35d5a880e9d4eedf25002f15e4fc" title="lbann::lbann_quantizer\l::adaptive_threshold_unquantize" alt="" coords="210,72,424,111"/><area shape="rect" id="node8" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="224,135,410,187"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#a7e5261b17fe2f3a8c52c12114e8b3873" title="lbann::lbann_quantizer\l::adaptive_threshold_unquantize" alt="" coords="472,5,686,44"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="488,68,669,120"/><area shape="rect" id="node6" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="742,133,907,185"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="734,57,915,109"/><area shape="rect" id="node9" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="486,197,672,249"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a259a27d1564f652217d590c52367f33f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>apply</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00363">363</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                                                       {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">threshold_unquantize</a>(quant, mat.Matrix(), pos_avg, neg_avg, apply);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aee4520768fa2d7d8869a9e4aea11b95b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b">lbann::lbann_quantizer::threshold_unquantize</a></div><div class="ttdeci">void threshold_unquantize(ThreshQuantized &amp;q, Mat &amp;mat, DataType pos_avg, DataType neg_avg, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00325">lbann_quantizer.cpp:325</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a259a27d1564f652217d590c52367f33f_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a259a27d1564f652217d590c52367f33f_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a259a27d1564f652217d590c52367f33f_cgraph" id="classlbann_1_1lbann__quantizer_a259a27d1564f652217d590c52367f33f_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#aee4520768fa2d7d8869a9e4aea11b95b" title="lbann::lbann_quantizer\l::threshold_unquantize" alt="" coords="210,5,366,44"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a093ad67bd1dcc6c11f76ee69dcf913d8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::threshold_unquantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::iterator&#160;</td>
          <td class="paramname"><em>qstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>pos_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>&#160;</td>
          <td class="paramname"><em>neg_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>apply</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handle threshold unquantization from arbitrary locations. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00331">331</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                                                            {</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keyword">const</span> Int ldim = mat.LDim();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a>* buf = mat.Buffer();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">if</span> (std::distance(quant_start, quant.end()) == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">// Decode the first location to start the delta decoding.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keyword">auto</span> iter = quant_start;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = *iter;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  ++iter;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordtype">size_t</span> prev_pos = q &gt;&gt; 1;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  <span class="keywordflow">if</span> (apply) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span> (q &amp; 1) buf[prev_pos] += pos_avg;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">else</span> buf[prev_pos] += neg_avg;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordflow">if</span> (q &amp; 1) buf[prev_pos] = pos_avg;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">else</span> buf[prev_pos] = neg_avg;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">for</span> (; iter != quant.end(); ++iter) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    q = *iter;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="keywordtype">size_t</span> pos = (q &gt;&gt; 1) + prev_pos;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    prev_pos = pos;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">if</span> (apply) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) buf[pos] += pos_avg;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      <span class="keywordflow">else</span> buf[pos] += neg_avg;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="keywordflow">if</span> (q &amp; 1) buf[pos] = pos_avg;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="keywordflow">else</span> buf[pos] = neg_avg;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00035">lbann_base.hpp:35</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a328e2bccf4ad0925e7f3efb6c9342b52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::uncompress_adaptive_thresholds </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00740">740</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                                                                         {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  q.push_back(cq[0]);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  q.push_back(cq[1]);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192">uncompress_thresholds</a>(cq, cq.begin() + 2, q);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0630145bb4f0d9755ee55babf098e192"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192">lbann::lbann_quantizer::uncompress_thresholds</a></div><div class="ttdeci">void uncompress_thresholds(ThreshQuantized &amp;cq, ThreshQuantized &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00678">lbann_quantizer.cpp:678</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a328e2bccf4ad0925e7f3efb6c9342b52_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a328e2bccf4ad0925e7f3efb6c9342b52_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a328e2bccf4ad0925e7f3efb6c9342b52_cgraph" id="classlbann_1_1lbann__quantizer_a328e2bccf4ad0925e7f3efb6c9342b52_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192" title="lbann::lbann_quantizer\l::uncompress_thresholds" alt="" coords="213,12,383,51"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a328e2bccf4ad0925e7f3efb6c9342b52_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a328e2bccf4ad0925e7f3efb6c9342b52_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a328e2bccf4ad0925e7f3efb6c9342b52_icgraph" id="classlbann_1_1lbann__quantizer_a328e2bccf4ad0925e7f3efb6c9342b52_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="213,44,394,96"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="450,5,616,57"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="442,81,623,133"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0630145bb4f0d9755ee55babf098e192"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::uncompress_thresholds </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Corresponding uncompress. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00678">678</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                                                                {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192">uncompress_thresholds</a>(cq, cq.begin(), q);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a0630145bb4f0d9755ee55babf098e192"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a0630145bb4f0d9755ee55babf098e192">lbann::lbann_quantizer::uncompress_thresholds</a></div><div class="ttdeci">void uncompress_thresholds(ThreshQuantized &amp;cq, ThreshQuantized &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00678">lbann_quantizer.cpp:678</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a0630145bb4f0d9755ee55babf098e192_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a0630145bb4f0d9755ee55babf098e192_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a0630145bb4f0d9755ee55babf098e192_icgraph" id="classlbann_1_1lbann__quantizer_a0630145bb4f0d9755ee55babf098e192_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a4cf9d4cd5262b21939e95fc34ad0a09f" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="224,37,409,89"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a328e2bccf4ad0925e7f3efb6c9342b52" title="lbann::lbann_quantizer\l::uncompress_adaptive\l_thresholds" alt="" coords="237,113,396,165"/><area shape="rect" id="node3" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="699,5,865,57"/><area shape="rect" id="node4" href="classlbann_1_1lbann__quantizer.html#ae99dc11003cecd04e599d68c99d90c0b" title="lbann::lbann_quantizer\l::intermodel_sum_threshold\l_quantized" alt="" coords="457,37,643,89"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a28e74da8473ea1b475ff3976676898c4" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="460,113,641,165"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#acf0864e7c687806af3155655a33ed364" title="lbann::lbann_quantizer\l::intermodel_sum_adaptive\l_threshold_quantized" alt="" coords="691,113,873,165"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a861a35c39d55ebec8bd1c385378c2109"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::uncompress_thresholds </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>cq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ThreshQuantized::iterator&#160;</td>
          <td class="paramname"><em>cqstart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a84c968d0f772235faa39f6ad91e7eadb">ThreshQuantized</a> &amp;&#160;</td>
          <td class="paramname"><em>q</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Handle uncompression starting from arbitrary locations. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00683">683</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                                                            {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> quotient = 0;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> remainder = 0;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <span class="comment">// Like in compress, cur_bit is the current bit being read.</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> cur_bit = 0;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = std::distance(cq.begin(), cqstart); i &lt; cq.size();) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> cur = cq[i];</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="comment">// Decode the quotient by continuing until we find a 0.</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">// If we hit the end without finding a 0, this was the end of the list.</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">while</span> ((cur &gt;&gt; cur_bit) &amp; 0x1) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      ++quotient;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      ++cur_bit;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="comment">// Hit end of current chunk.</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        ++i;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">if</span> (i == cq.size()) {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;          <span class="keywordflow">return</span>;  <span class="comment">// Nothing left.</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        cur = cq[i];</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        cur_bit = 0;</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      }</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="comment">// Skip past the 0.</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    ++cur_bit;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      ++i;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      cur = cq[i];</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      cur_bit = 0;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">// Decode the remainder (GR_K bits).</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">if</span> (cur_bit + <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> &lt;= <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="comment">// Remainder is entirely in the current chunk.</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      remainder = (cur &gt;&gt; cur_bit) &amp; (<a class="code" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> - 1);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      cur_bit += <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <span class="keywordflow">if</span> (cur_bit == <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        ++i;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        cur_bit = 0;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      }</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="comment">// Remainder is split over this and the next chunk.</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> bits_left = <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a> - cur_bit;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="comment">// Start with the top bits_left bits.</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      remainder = cur &gt;&gt; cur_bit;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      ++i;</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      cur = cq[i];</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="comment">// Now get remaining GR_K - bits_left bits from the new cur.</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      remainder |= (cur &amp; ((1 &lt;&lt; (<a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> - bits_left)) - 1)) &lt;&lt; bits_left;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      cur_bit = <a class="code" href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">GR_K</a> - bits_left;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">// Now decode the final value.</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    q.push_back(quotient * <a class="code" href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">GR_M</a> + remainder);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    quotient = 0;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    remainder = 0;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_ad98118c77f676fa3d3fb4ba27b814070"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#ad98118c77f676fa3d3fb4ba27b814070">lbann::lbann_quantizer::GR_M</a></div><div class="ttdeci">static const uqtype GR_M</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00222">lbann_quantizer.hpp:222</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a5f645c840854c584c9224af063fee23b"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a5f645c840854c584c9224af063fee23b">lbann::lbann_quantizer::GR_K</a></div><div class="ttdeci">static const uqtype GR_K</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00224">lbann_quantizer.hpp:224</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00217">lbann_quantizer.hpp:217</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a02c763978957572c718ddc4c0544833e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::unquantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>apply</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unquantize a matrix. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qmat</td><td>The matrix to unquantize. </td></tr>
    <tr><td class="paramname">mat</td><td>The output unquantized matrix. </td></tr>
    <tr><td class="paramname">apply</td><td>Whether to add or replace existing entries. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00112">112</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                                                                            {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; mat.Width(); ++col) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordtype">int</span> row_chunk = 0;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordtype">int</span> qrow = 2;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="comment">// Extract the averages.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <a class="code" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a> tmp = qmat.Get(0, col);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_pos;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    memcpy(&amp;avg_pos, &amp;tmp, <span class="keyword">sizeof</span>(avg_pos));</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    tmp = qmat.Get(1, col);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a> avg_neg;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    memcpy(&amp;avg_neg, &amp;tmp, <span class="keyword">sizeof</span>(avg_neg));</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="comment">// Unquantize this column.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">for</span> (; row_chunk &lt; mat.Height(); row_chunk += <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> q = (<a class="code" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a>) qmat.Get(qrow, col);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> bit = 0; bit &lt; <a class="code" href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">NUM_BITS</a>; ++bit) {</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordtype">int</span> row = row_chunk + bit;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="keywordflow">if</span> (row &gt;= mat.Height()) {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">if</span> (apply) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;          mat.Update(row, col, (q &gt;&gt; bit) &amp; 0x1 ? avg_pos : avg_neg);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;          mat.Set(row, col, (q &gt;&gt; bit) &amp; 0x1 ? avg_pos : avg_neg);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        }</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      ++qrow;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_af6bfe410c16ab39ca55861afb7c53134"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">lbann::lbann_quantizer::uqtype</a></div><div class="ttdeci">uint32_t uqtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00054">lbann_quantizer.hpp:54</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_aad6499ee349e94a461538a8e4f867048"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">lbann::lbann_quantizer::qtype</a></div><div class="ttdeci">int32_t qtype</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00055">lbann_quantizer.hpp:55</a></div></div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a33ea17392f53b90e91aea1ffb7e11d68"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a33ea17392f53b90e91aea1ffb7e11d68">lbann::lbann_quantizer::NUM_BITS</a></div><div class="ttdeci">static const size_t NUM_BITS</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8hpp_source.html#l00217">lbann_quantizer.hpp:217</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a279b64f47fb2213ad73e59be937afcfa"><div class="ttname"><a href="lbann__base_8hpp.html#a279b64f47fb2213ad73e59be937afcfa">DataType</a></div><div class="ttdeci">float DataType</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00035">lbann_base.hpp:35</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a02c763978957572c718ddc4c0544833e_icgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a02c763978957572c718ddc4c0544833e_icgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a02c763978957572c718ddc4c0544833e_icgraph" id="classlbann_1_1lbann__quantizer_a02c763978957572c718ddc4c0544833e_icgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a8a7fe58287a9ff7a02ea91954d8b9d80" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="230,19,386,57"/><area shape="rect" id="node3" href="classlbann_1_1lbann__quantizer.html#a97db186341c0819c8d52e2f815deb2a7" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="213,81,402,120"/><area shape="rect" id="node6" href="classlbann_1_1lbann__quantizer.html#a0e271e3f75667540f5bde94fbcd3ef0e" title="lbann::lbann_quantizer\l::intermodel_sum_quantized2" alt="" coords="210,144,406,183"/><area shape="rect" id="node4" href="classlbann_1_1lbann__callback__imcomm.html#af3d0a9f520cce8938ba7ce25c09baf30" title="lbann::lbann_callback\l_imcomm::on_backward\l_prop_end" alt="" coords="469,5,635,57"/><area shape="rect" id="node5" href="classlbann_1_1lbann__quantizer.html#a4877befb2683f16a03fdf91ed1353636" title="lbann::lbann_quantizer\l::intermodel_sum_quantized" alt="" coords="458,81,646,120"/><area shape="rect" id="node7" href="classlbann_1_1lbann__quantizer.html#a35ca3e61f358ccb63c233d85236dfec1" title="lbann::lbann_quantizer\l::intermodel_sum_quantized2" alt="" coords="454,144,650,183"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8a7fe58287a9ff7a02ea91954d8b9d80"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lbann::lbann_quantizer::unquantize </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classlbann_1_1lbann__quantizer.html#a2f0b1c91b994c91dfa506869e3329db6">QuantizedMatrix</a> &amp;&#160;</td>
          <td class="paramname"><em>qmat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="lbann__base_8hpp.html#a270ddda44ad6a3abd3cfe8358cf581e6">DistMat</a> &amp;&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>apply</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="lbann__quantizer_8cpp_source.html#l00142">142</a> of file <a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                             {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a>&amp; local_mat = mat.Matrix();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <a class="code" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e">unquantize</a>(qmat, local_mat, apply);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="ttc" id="classlbann_1_1lbann__quantizer_html_a02c763978957572c718ddc4c0544833e"><div class="ttname"><a href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e">lbann::lbann_quantizer::unquantize</a></div><div class="ttdeci">void unquantize(QuantizedMatrix &amp;qmat, Mat &amp;mat, bool apply=false)</div><div class="ttdef"><b>Definition:</b> <a href="lbann__quantizer_8cpp_source.html#l00112">lbann_quantizer.cpp:112</a></div></div>
<div class="ttc" id="lbann__base_8hpp_html_a483ed30937584c6d3a4d76bff5215a34"><div class="ttname"><a href="lbann__base_8hpp.html#a483ed30937584c6d3a4d76bff5215a34">Mat</a></div><div class="ttdeci">El::Matrix&lt; DataType &gt; Mat</div><div class="ttdef"><b>Definition:</b> <a href="lbann__base_8hpp_source.html#l00040">lbann_base.hpp:40</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classlbann_1_1lbann__quantizer_a8a7fe58287a9ff7a02ea91954d8b9d80_cgraph.png" border="0" usemap="#classlbann_1_1lbann__quantizer_a8a7fe58287a9ff7a02ea91954d8b9d80_cgraph" alt=""/></div>
<map name="classlbann_1_1lbann__quantizer_a8a7fe58287a9ff7a02ea91954d8b9d80_cgraph" id="classlbann_1_1lbann__quantizer_a8a7fe58287a9ff7a02ea91954d8b9d80_cgraph">
<area shape="rect" id="node2" href="classlbann_1_1lbann__quantizer.html#a02c763978957572c718ddc4c0544833e" title="lbann::lbann_quantizer\l::unquantize" alt="" coords="210,5,366,44"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a5f645c840854c584c9224af063fee23b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> lbann::lbann_quantizer::GR_K = 4</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>log_2(GR_M). </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00224">224</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad98118c77f676fa3d3fb4ba27b814070"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classlbann_1_1lbann__quantizer.html#af6bfe410c16ab39ca55861afb7c53134">uqtype</a> lbann::lbann_quantizer::GR_M = 16</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Golumb-Rice M parameter, a power of 2. Should be large-ish relative to the data being encoded, but log_2(GR_M) should be &lt;= 31. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00222">222</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a33ea17392f53b90e91aea1ffb7e11d68"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t lbann::lbann_quantizer::NUM_BITS = sizeof(<a class="el" href="classlbann_1_1lbann__quantizer.html#aad6499ee349e94a461538a8e4f867048">qtype</a>) * 8</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Number of bits per quantized word. </p>

<p>Definition at line <a class="el" href="lbann__quantizer_8hpp_source.html#l00217">217</a> of file <a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/lbann/utils/<a class="el" href="lbann__quantizer_8hpp_source.html">lbann_quantizer.hpp</a></li>
<li>src/utils/<a class="el" href="lbann__quantizer_8cpp_source.html">lbann_quantizer.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacelbann.html">lbann</a></li><li class="navelem"><a class="el" href="classlbann_1_1lbann__quantizer.html">lbann_quantizer</a></li>
    <li class="footer">Generated on Mon Jul 18 2016 10:16:11 for LBANN by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
